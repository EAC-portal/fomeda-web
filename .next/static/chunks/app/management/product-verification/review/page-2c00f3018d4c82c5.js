(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6937],{33641:function(e,s,i){Promise.resolve().then(i.bind(i,58180))},58180:function(e,s,i){"use strict";i.r(s);var c=i(57437),t=i(50413),r=i(73454),a=i(77738),n=i(77733),l=i(95381),o=i(88625),d=i(46682),u=i(7673),p=i(74011),f=i(65783),_=i(43561),m=i(16463),h=i(2265),b=i(19030),x=i(37310),j=i(31919),v=i(34682),g=i(50040),y=i(85327),Z=i(33768),E=i(5951),P=i(35945),N=i(82649),R=i(55166);s.default=()=>{var e,s,i;let w=(0,m.useRouter)(),C=(0,m.useSearchParams)().get("id"),[A]=r.Z.useForm(),[I,k]=(0,h.useState)(),[O,T]=(0,h.useState)(0),[M,V]=(0,h.useState)(0),[F,S]=(0,h.useState)(!1);(0,h.useEffect)(()=>{(async()=>{try{S(!0);let s=await b.Z.getProductVerificationDetailsById(C);if(s){var e;let i=[{spec_name:"Product Name",spec_desc:s.product_name,spec_type:R.rJ.INFORMATION,spec_id:"product_name",is_default:!0},{spec_name:"Model No.",spec_desc:s.model_no,spec_type:R.rJ.INFORMATION,spec_id:"model_no",is_default:!0},{spec_name:"Category",spec_desc:s.cat_name,spec_type:R.rJ.INFORMATION,spec_id:"category",is_default:!0},{spec_name:"Subcategory",spec_desc:s.subcat_name,spec_type:R.rJ.INFORMATION,spec_id:"subcategory",is_default:!0}];s.specification=[...i,...null!==(e=s.specification)&&void 0!==e?e:[]],k(s),J(A.getFieldValue("specification"))}}catch(e){throw console.error(e),e}})().then(()=>S(!1))},[A,C]),(0,h.useEffect)(()=>{I&&void 0!==M&&(()=>{var e;let s=null==I?void 0:I.rating_score,i=null==s?void 0:s.find(e=>M<=e.max_score&&M>=e.min_score);T(null!==(e=null==i?void 0:i.rating)&&void 0!==e?e:0)})()},[M,I]);let J=e=>{let s=0;Object.values(e||{}).forEach(e=>{e.subspecification?Object.values(e.subspecification).forEach(e=>{void 0===e.score||isNaN(e.score)||(s+=Number(e.score))}):void 0===e.score||isNaN(e.score)||(s+=Number(e.score))}),V(s)},D=async e=>{if(e===v.Py.REJECTED&&(!A.getFieldValue("rejected_reason")||""===A.getFieldValue("rejected_reason").trim())){E.Z.error("Reject Reason is required to reject application.");return}if(e===v.Py.APPROVED){if(0===O){E.Z.error("Minimum of 1 star is required to approve a product");return}try{await A.validateFields()}catch(e){E.Z.error("Please fill in all required fields.");return}}let s=e===v.Py.REJECTED?v.Py.REJECT_ACTION:v.Py.APPROVE_ACTION;a.Z.confirm({title:(0,c.jsx)("h3",{children:"Confirmation"}),content:(0,c.jsx)(P.Z,{action:s,record:I,details:"product application"}),className:"confirmation-modal",centered:!0,width:"35%",okText:"Confirm",onOk:()=>G(e)})},G=async e=>{var s;let i=A.getFieldsValue(),c=(null==I?void 0:null===(s=I.specification)||void 0===s?void 0:s.filter(e=>!e.is_default))||[],t={...I,...i,rating:O,total_score:M,status:e,specification:B(c||[],i.specification||[])},r=g.x.formatTitleCase(e);try{await b.Z.updateProductVerificationReviewById(C,t),w.back(),N.Z.success("".concat(r," Application"),"".concat(null==I?void 0:I.product_name," Application is ").concat(r," successfully."))}catch(s){throw N.Z.error("".concat(r," Application"),"".concat(null==I?void 0:I.product_name," Application failed to ").concat(e===v.Py.REJECTED?"reject":"approve")),s}},X=(e,s)=>e.map(e=>{let i=s.find(s=>s.subspec_id===e.subspec_id);return i?{subspec_id:e.subspec_id,subspec_desc:i.subspec_desc,score:e.score}:null}).filter(e=>null!==e),z=(e,s)=>{let i={spec_id:e.spec_id,spec_desc:s.spec_desc,score:e.score};return e.subspecification&&s.subspecification&&(i.subspecification=X(Object.values(e.subspecification),s.subspecification)),i},B=(e,s)=>Object.values(s).map(s=>{let i=e.find(e=>e.spec_id===s.spec_id);return i?z(s,i):null}).filter(e=>null!==e),H=e=>e.map(e=>{switch(e.key){case"spec_name":return{...e,render:(e,s)=>{let i=s.subspec_name||s.spec_name;return(0,c.jsx)("span",{children:i})},sorter:(e,s)=>(e.spec_name||e.subspec_name).localeCompare(s.subcat_spec_name||s.subcat_subspec_name)};case"spec_desc":return{...e,render:(e,s)=>{var i;if((null===(i=s.subspecification)||void 0===i?void 0:i.length)>0)return(0,c.jsx)(c.Fragment,{});let t=s.subspec_desc||s.spec_desc,r=t?[s.prefix,t,s.suffix].filter(Boolean).join(" "):"-";return(0,c.jsx)("span",{children:r})}};case"score":return{...e,render:(e,s)=>K(s)};default:return{...e,sorter:(s,i)=>(s[e.key]||"").toString().localeCompare((i[e.key]||"").toString())}}}),K=e=>{if(e.subspecification&&e.subspecification.length>0)return(0,c.jsx)(c.Fragment,{});let s=e.subspec_name||e.spec_name,i=0,t=e.rating_score||[],a=t.map(t=>(t.score>i&&(i=t.score),(0,c.jsxs)("div",{children:[s," ",g.x.formatLowerCase(t.action,"_")," ",e.prefix," ",t.value," ",e.suffix," = ",t.score," mark(s);"]},t._id)));return(0,c.jsxs)(n.Z,{children:[(0,c.jsxs)(l.Z,{children:[(0,c.jsx)(r.Z.Item,{hidden:!0,name:["specification",e.spec_id,"spec_id"],initialValue:e.spec_id}),e.subspec_id&&(0,c.jsx)(r.Z.Item,{hidden:!0,name:["specification",e.spec_id,"subspecification",e.subspec_id,"subspec_id"],initialValue:e.subspec_id}),(0,c.jsx)(r.Z.Item,{name:e.subspec_id?["specification",e.spec_id,"subspecification",e.subspec_id,"score"]:["specification",e.spec_id,"score"],initialValue:e.score,className:"mb-0",rules:[{validator:(e,c)=>c>i?Promise.reject(Error("".concat(s," core cannot exceed ").concat(i))):Promise.resolve()}],children:(0,c.jsx)(Z.Z,{type:"numeric",disabled:t.length<=0})})]}),(0,c.jsx)(l.Z,{children:t.length>0?(0,c.jsx)(o.Z,{title:a,children:(0,c.jsx)(d.ZP,{type:"text",shape:"circle",icon:(0,c.jsx)(x.Z,{})})}):(0,c.jsx)(d.ZP,{type:"text",shape:"circle",icon:(0,c.jsx)(x.Z,{}),disabled:!0})})]})};return(0,c.jsxs)(t.default,{title:"Product Details",isRoot:!1,children:[(0,c.jsx)(u.Z,{className:"max-w-96 bg-gray-300 mb-8",children:(null==I?void 0:null===(e=I.product_img)||void 0===e?void 0:e.file.preview)?(0,c.jsx)(p.Z,{src:null===(i=I.product_img)||void 0===i?void 0:null===(s=i.file)||void 0===s?void 0:s.preview,alt:"product_img",className:"max-h-96 object-cover"}):(0,c.jsx)(j.Z,{className:"text-5xl py-44 justify-center text-gray-500"})}),(0,c.jsxs)(r.Z,{form:A,onValuesChange:(e,s)=>{J(s.specification)},children:[v.m.map(e=>{var s,i;return(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsx)("h3",{children:e.title}),(0,c.jsx)(f.Z,{columns:H(e.tableHeader),dataSource:null==I?void 0:null===(s=I.specification)||void 0===s?void 0:s.filter(s=>s.spec_type===e.type).map(e=>{let s={...e,key:e.spec_id};return e.subspecification&&e.subspecification.length>0&&(s.children=e.subspecification.map(e=>({...e,key:e.subspec_id}))),s}),pagination:!1,showSorterTooltip:!1,loading:F,expandable:{expandedRowKeys:null==I?void 0:null===(i=I.specification)||void 0===i?void 0:i.filter(s=>s.spec_type===e.type).filter(e=>e.subspecification&&e.subspecification.length>0).map(e=>e.spec_id),expandIcon:()=>null}})]},e.key)}),(0,c.jsx)("h3",{children:"Overall Rating"}),(0,c.jsx)(r.Z.Item,{label:(0,c.jsx)("h5",{children:"Total Score"}),labelAlign:"left",labelCol:{span:4},className:"ml-8 mb-2",children:(0,c.jsx)("div",{children:M})}),(0,c.jsx)(r.Z.Item,{label:(0,c.jsx)("h5",{children:"Rating"}),labelAlign:"left",labelCol:{span:4},className:"ml-8 mb-2",children:(0,c.jsx)(_.Z,{disabled:!0,value:O})}),(0,c.jsx)("h3",{children:"Reject"}),(0,c.jsx)(r.Z.Item,{label:(0,c.jsx)("h5",{children:"Reject Reason"}),labelAlign:"left",labelCol:{span:4},className:"ml-8 mb-2",name:"rejected_reason",children:(0,c.jsxs)(l.Z,{span:16,children:[(0,c.jsx)(y.Z,{rows:5}),(0,c.jsx)("div",{className:"text-yellow-500",children:(0,c.jsxs)("i",{children:[(0,c.jsx)(x.Z,{})," This field is required to reject this application."]})})]})})]}),(0,c.jsxs)(n.Z,{className:"justify-end space-x-3 my-4",children:[(0,c.jsx)(d.ZP,{type:"default",size:"large",onClick:()=>w.back(),children:"Cancel"}),(0,c.jsx)(d.ZP,{type:"primary",size:"large",onClick:()=>D(v.Py.REJECTED),danger:!0,children:"Rejected"}),(0,c.jsx)(d.ZP,{type:"primary",size:"large",onClick:()=>D(v.Py.APPROVED),children:"Approve"})]})]})}},33768:function(e,s,i){"use strict";var c=i(57437),t=i(25325),r=i(6762);s.Z=e=>{let{value:s,type:i="alphanumeric",onChange:a,...n}=e;return(0,c.jsx)(t.default,{value:s,onChange:e=>{let s;let c=e.target.value;if(""===c)s=!0;else switch(i){case"numeric":s=r.K.REGEX_NUMERIC.test(c);break;case"alphabet":s=r.K.REGEX_ALPHABET.test(c);break;case"alphanumeric":s=r.K.REGEX_ALPHANUMERIC.test(c);break;default:s=!0}a&&s&&a(c)},...n})}},35945:function(e,s,i){"use strict";var c=i(57437);s.Z=e=>{let{action:s,record:i,details:t}=e;return(0,c.jsxs)("div",{children:[(0,c.jsx)("br",{}),"Are you confirmed to ",(0,c.jsx)("b",{children:s})," this ",t,"?",(0,c.jsx)("br",{}),(0,c.jsxs)("div",{children:[(0,c.jsx)("b",{children:"Product:"})," ",i.product_name]}),(0,c.jsx)("br",{})]})}},6762:function(e,s,i){"use strict";i.d(s,{K:function(){return c}});class c{}c.REGEX_ALPHABET=/^[a-zA-Z\s\-\_]+$/,c.REGEX_NUMERIC=/^\d*\.?\d*$/,c.REGEX_ALPHANUMERIC=/^[a-zA-Z0-9\s\-\_\@\#\!\$]+$/},5951:function(e,s,i){"use strict";var c=i(71768);class t{static showMessage(e,s){switch(e){case"success":return c.ZP.success(s);case"error":return c.ZP.error(s);case"warning":return c.ZP.warning(s);default:return c.ZP.info(s)}}static success(e){return this.showMessage("success",e)}static error(e){return this.showMessage("error",e)}static warning(e){return this.showMessage("warning",e)}static info(e){return this.showMessage("info",e)}}s.Z=t}},function(e){e.O(0,[3276,9665,3419,3454,5325,7460,7382,7373,7738,4052,6487,5783,509,3495,413,3149,2971,7023,1744],function(){return e(e.s=33641)}),_N_E=e.O()}]);