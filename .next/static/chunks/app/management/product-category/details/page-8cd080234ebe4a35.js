(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8728],{67791:function(e,t,a){Promise.resolve().then(a.bind(a,7398))},7398:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return k}});var c=a(57437),i=a(16463),r=a(88372),s=a(2265),n=a(55166),o=a(3650),l=a(73454),d=a(30252),u=a(77738),m=a(99368),p=a(46682),_=a(77733),y=a(95381),f=a(65783),h=a(71480),b=a(56115),g=a(99765),x=a(52875),Z=a(33768),S=a(82649),j=a(50040);let v=e=>e?(0,c.jsx)(o.Z,{color:"green",bordered:!1,className:"px-3 py-0.5 rounded-xl",children:"Active"}):(0,c.jsx)(o.Z,{bordered:!1,className:"px-3 py-0.5 rounded-xl",children:"Inactive"});var E=e=>{let{id:t}=e,a=(0,i.useRouter)(),o=!t.includes("SCAT"),[E]=l.Z.useForm(),[C,k]=(0,s.useState)([]),[A,w]=(0,s.useState)(!0),[T,M]=(0,s.useState)([]),[R,D]=(0,s.useState)([]),[N,I]=(0,s.useState)(!1),F=(e,t)=>e.map(e=>t.is_active&&"activate"===e.key||!t.is_active&&"deactivate"===e.key?null:{key:e.key,label:(0,c.jsx)(d.default,{onClick:()=>P(e.key,t),children:e.label})}).filter(e=>null!==e),P=(e,t)=>{"view_specification"===e?a.push("view-specification?type=".concat(t.cat_type,"&id=").concat(t._id)):u.Z.confirm({title:(0,c.jsx)("h3",{children:"Confirmation"}),content:(0,c.jsx)(x.Z,{action:e,record:t}),className:"confirmation-modal",centered:!0,width:"35%",okText:"Confirm",onOk:()=>B(e,t)})},Y={deactivate:{spec:o?r.Z.deactivateCategoryBaseSpecification:r.Z.deactivateSubcategorySpecification,subspec:o?r.Z.deactivateCategoryBaseSubspecification:r.Z.deactivateSubcategorySubspecification},activate:{spec:o?r.Z.deactivateCategoryBaseSpecification:r.Z.deactivateSubcategorySpecification,subspec:o?r.Z.deactivateCategoryBaseSubspecification:r.Z.deactivateSubcategorySubspecification},delete:{spec:o?r.Z.deleteCategoryBaseSpecification:r.Z.deleteSubcategorySpecification,subspec:o?r.Z.deleteCategoryBaseSubspecification:r.Z.deleteSubcategorySubspecification}},B=async(e,t)=>{let{_id:a,subcat_subspec_name:c,subcat_spec_name:i}=t;try{var r;let t=null===(r=Y[e])||void 0===r?void 0:r[c?"subspec":"spec"];t?(await t(a,"activate"===e),S.Z.success("".concat(j.x.formatTitleCase(e)," Specification"),"".concat(c||i," ").concat(e," successfully"))):S.Z.error("".concat(j.x.formatTitleCase(e)," Specification"),"".concat(c||i," failed to ").concat(e)),await z()}catch(e){console.error(e)}},O=async()=>{try{await E.validateFields();let e=E.getFieldsValue(),a=R.map(t=>({...t,max_score:parseInt(e["".concat(t.rating,"_max_score")]),min_score:parseInt(e["".concat(t.rating,"_min_score")])}));D(a),await r.Z.updateSubcategory(t,{rating_score:a}),I(!1)}catch(e){throw console.error(e),e}},G=async(e,t)=>{let a=E.getFieldsValue(),c=parseInt(a["".concat(t.rating,"_min_score")],10),i=parseInt(a["".concat(t.rating,"_max_score")],10);if("max_score"===e&&i<c)return Promise.reject(Error("Max score must be greater than or equal to Min score"));let r=R.find(e=>e.rating===t.rating-1);if(r){let t=parseInt(a["".concat(r.rating,"_max_score")],10);if("min_score"===e&&c!==t+1)return Promise.reject(Error("Min score must be exactly ".concat(t+1)))}return Promise.resolve()},L=(e,t)=>(0,c.jsx)(m.Z,{menu:{items:F(e,t)},disabled:!1===t.is_origin,children:(0,c.jsx)(p.ZP,{children:"Actions"})}),H=(e,t)=>(0,c.jsx)(c.Fragment,{children:N?(0,c.jsx)(l.Z,{form:E,children:(0,c.jsx)(l.Z.Item,{name:"".concat(e.rating,"_").concat(t),initialValue:e[t],className:"mb-0",rules:[{required:!0,message:"Score should not be empty"},{validator:async(a,c)=>G(t,e)}],children:(0,c.jsx)(Z.Z,{type:"numeric"})})}):(0,c.jsx)("div",{children:e[t]})}),U=e=>e.map(e=>{switch(e.key){case"subcat_spec_name":return{...e,render:(e,t)=>{let a=t.subcat_spec_name||t.subcat_subspec_name;return(0,c.jsx)("span",{children:a})},sorter:(e,t)=>(e.subcat_spec_name||e.subcat_subspec_name).localeCompare(t.subcat_spec_name||t.subcat_subspec_name)};case"is_active":return{...e,render:e=>v(e),sorter:(e,t)=>t.is_active-e.is_active};case"actions":return{...e,render:(t,a)=>L(e.actionList,a)};case"created_on":case"last_updated_on":return{...e,render:(t,a)=>g.I.formatDate(a[e.key],g.I.CATEGORY_DATE_FORMAT),sorter:(t,a)=>new Date(t[e.key]).getTime()-new Date(a[e.key]).getTime()};case"min_score":case"max_score":return{...e,render:(t,a)=>H(a,e.key)};default:return{...e,sorter:(t,a)=>(t[e.key]||"").toString().localeCompare((a[e.key]||"").toString())}}}),X=(0,s.useCallback)(async()=>{try{var e;let a,c;let i=await r.Z.findNameById(t);M(i),o?(console.log("run here"),c=await r.Z.findCategoryBaseSpecificationByCatId(t)):(c=await r.Z.findSubcategorySpecificationByCatId(t),a=await r.Z.findOneSubcategoryById(t)),k(c),D(null!==(e=null==a?void 0:a.rating_score)&&void 0!==e?e:{})}catch(e){throw console.error(e),e}finally{w(!1)}},[t,o]),z=async()=>{await X()};return(0,s.useEffect)(()=>{X().then()},[X]),(0,c.jsxs)("div",{children:[(0,c.jsxs)(_.Z,{className:"mb-3",children:[(0,c.jsx)(y.Z,{span:8,children:(0,c.jsxs)("h3",{className:"font-normal ml-1 truncate",children:[(0,c.jsx)("b",{children:"Category:"})," ",T.cat_name]})}),o?(0,c.jsx)(c.Fragment,{}):(0,c.jsx)(y.Z,{span:8,children:(0,c.jsxs)("h3",{className:"font-normal ml-1 truncate",children:[(0,c.jsx)("b",{children:"Subcategory:"})," ",T.subcat_name]})})]}),!o&&(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(_.Z,{className:"mb-2 justify-between",children:[(0,c.jsx)("h3",{children:"RatingScore"}),(0,c.jsx)(p.ZP,{type:"primary",icon:(0,c.jsx)(h.Z,{}),onClick:()=>I(!0),disabled:N,children:"Edit Rating Score"})]}),(0,c.jsx)(f.Z,{columns:U(n.wD),dataSource:R.map(e=>({...e,key:e.rating})),showSorterTooltip:!1,pagination:!1,className:"mb-12",footer:N?()=>(0,c.jsxs)(_.Z,{className:"justify-end space-x-3",children:[(0,c.jsx)(p.ZP,{onClick:()=>I(!1),children:"Cancel"}),(0,c.jsx)(p.ZP,{onClick:O,type:"primary",children:"Save"})]}):void 0,loading:A})]}),n.ZM.map(e=>(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsxs)(_.Z,{className:"mb-2 justify-between",children:[(0,c.jsx)("h3",{children:e.title}),(0,c.jsx)(p.ZP,{type:"primary",icon:(0,c.jsx)(b.Z,{}),onClick:()=>{a.push("add-specification?type=".concat(e.type,"&id=").concat(t))},children:e.button})]}),(0,c.jsx)(f.Z,{columns:U(e.tableHeader),dataSource:C.filter(t=>t.cat_type===e.type).map((e,t)=>{let a={...e,key:t};return e.children&&e.children.length>0&&(a.children=e.children.map((a,c)=>({...a,key:"".concat(t,"-").concat(c),parent_name:e.subcat_spec_name,cat_type:e.cat_type,is_origin:e.is_origin}))),a}),pagination:{defaultPageSize:10,showSizeChanger:!0,pageSizeOptions:[10,20,50,100]},showSorterTooltip:!1,loading:A})]},e.key))]})},C=a(50413),k=()=>{let e=(0,i.useSearchParams)().get("id");return(0,c.jsx)(C.default,{title:"Category Details",isRoot:!1,children:(0,c.jsx)(E,{id:e})})}},33768:function(e,t,a){"use strict";var c=a(57437),i=a(25325),r=a(6762);t.Z=e=>{let{value:t,type:a="alphanumeric",onChange:s,...n}=e;return(0,c.jsx)(i.default,{value:t,onChange:e=>{let t;let c=e.target.value;if(""===c)t=!0;else switch(a){case"numeric":t=r.K.REGEX_NUMERIC.test(c);break;case"alphabet":t=r.K.REGEX_ALPHABET.test(c);break;case"alphanumeric":t=r.K.REGEX_ALPHANUMERIC.test(c);break;default:t=!0}s&&t&&s(c)},...n})}},6762:function(e,t,a){"use strict";a.d(t,{K:function(){return c}});class c{}c.REGEX_ALPHABET=/^[a-zA-Z\s\-\_]+$/,c.REGEX_NUMERIC=/^\d*\.?\d*$/,c.REGEX_ALPHANUMERIC=/^[a-zA-Z0-9\s\-\_\@\#\!\$]+$/},99765:function(e,t,a){"use strict";a.d(t,{I:function(){return r}});var c=a(62737),i=a.n(c);class r{static formatDate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r.DEFAULT_DATE_FORMAT;return e?i()(e).format(t):""}}r.DEFAULT_DATE_FORMAT="YYYY-MM-DD",r.DEFAULT_DATE_TIME_FORMAT="YYYY-MM-DD HH:mm:ss",r.CATEGORY_DATE_FORMAT="DD MMM YYYY"}},function(e){e.O(0,[3276,9665,3419,3454,5325,252,7460,7382,7373,7738,4052,6487,5783,9009,413,5539,2971,7023,1744],function(){return e(e.s=67791)}),_N_E=e.O()}]);